---
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: flatly
    highlight: kate
editor_options: 
  markdown: 
    wrap: 72
---

```{=html}
<style>
.leaflet {
    margin: auto;
}
h2,h3,h4 {
  font-family:'lobster';
  color:#35518f
}
</style>
```

<h1>
# [Learner Map Demo]{style="font-family:'lobster'; color:#ff3599"}üìçüó∫
</h1>
------------------------------------------------------------------------

#### üëã Welcome! üëã

This is a short vignette to show you how easy it can be to create
impressive figures and documents with R and Rmarkdown.

------------------------------------------------------------------------

#### Do this to start

-   Go to Google maps, find your area (not exact location), right-click and copy your coordinates (latitude, longitude).
-   Paste your coordinates here: <https://forms.gle/1XoxfkhGLxqEHik9A>

--------------------------------------------------------------

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r}
# install.packages(c('tidyverse', 'leaflet', 'googlesheets4'))
# load packages
library(tidyverse)
library(leaflet)
library(googlesheets4)
```

--------------------------------------------------------------

## Google API

Google offers an Application Programming Interface (API) to work with
files stored in the cloud through code.
<!-- API is a really general term that basically means software that coders use as part of their projects. -->

The data you entered into the form are collected into a
[spreadsheet](https://docs.google.com/spreadsheets/d/1EpByX-P6ou74xqcTF4gX388g-zbMEHPyHsBZADyMhsU/edit#gid=719575535)
that anyone can read from.

(You'll need a google account to their API. `googlesheets4` will prompt
you to set up an access token for your account, then Google will ask you
to confirm that you want to allow the tidyverse API to access your files
-\> check the box that allows the Tidyverse API

```{r}
coords <-
  # read data from this url
  googlesheets4::read_sheet( "https://docs.google.com/spreadsheets/d/1EpByX-P6ou74xqcTF4gX388g-zbMEHPyHsBZADyMhsU/edit?usp=sharing")

# preview data
coords |> head()
```

--------------------------------------------------------------

Now that our data is loaded, let's create some html-formatted text with
details to show as popups for each marker.

```{r}
# mutate() creates a new column that we've called 'popup'
# str_glue() inserts our data variables into a text template,
# variables are referenced by name in code expressions wrapped with {}
coords <- coords |>
  mutate(popup = str_glue(
    'Responded at <b>{Timestamp}</b><br>
     Lat ~ <b>{round(latitude, 2)}</b><br>
     Lng ~ <b>{round(longitude, 2)}</b>') |> 
      as.character()
    )

# check the new column we created
coords |> head()
```

--------------------------------------------------------------

## [Leaflet]{style="font-family:'lobster'; color:#35518f"}

We'll use the Leaflet package to build our map in layers: canvas -\>
background -\> data markers.

<!-- this is html that wont show up in the final document -->

```{r fig.height=6, fig.width=8, fig.cap="Here's our map!"}
# blank map
leaflet::leaflet() |>
  # add the base layer style
  leaflet::addProviderTiles(
    providers$CartoDB,
    options = providerTileOptions(noWrap = TRUE)
  ) |>
  # add markers based on survey data
  leaflet::addMarkers(
    data = coords,
    lng = ~longitude,
    lat = ~latitude,
    label = ~str_glue('{latitude}, {longitude}'),
    popup = ~popup
    ) 
```

--------------------------------------------------------------

<br> <br> <br> <br> <br>

--------------------------------------------------------------

##  [ Pretty cool, right! ]{style="font-family:'lobster'; color:#35518f"}

Now that you've seen the potential rewards of working with R, Let's back it up a bit and give you a crash course in the
basics. Then we'll get back to making fun visualizations.

![](https://github.com/jmoggridge/learn_to_code_seminar/raw/main/acorn.png){width="500"}

--------------------------------------------------------------

<br> <br> 
